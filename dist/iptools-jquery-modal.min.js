/*! iptools-jquery-modal - v1.4.0 - 2017-05-09
* https://github.com/interactive-pioneers/iptools-jquery-modal
* Copyright Â© 2017 Interactive Pioneers GmbH; Licensed GPL-3.0 */
!function(a,b,c){"use strict";function d(d,f){function g(){X&&(X.remove(),X=null)}function h(a){return a+"."+e}function i(){a(c).off(h("keydown")).off(h("mouseup")).off(h("touchstart")),a(b).off(h("resize"))}function j(){da.element.off("ajax:complete").off("ajax:success").off("ajax:error")}function k(){Y&&(Y.remove(),Y=null,_=!1)}function l(){W&&(W.hide(),W.remove())}function m(){l(),da.element.trigger(h("complete"))}function n(){da.element.trigger(h("close"))}function o(){da.element.trigger(h("ignore"))}function p(){m()}function q(){var a=Y.outerHeight(),b=X.height();a>b?Y.removeClass(U.modalVAlignCenterClass).addClass(U.modalVAlignTopClass):Y.removeClass(U.modalVAlignTopClass).addClass(U.modalVAlignCenterClass)}function r(){clearTimeout(ba),ba=setTimeout(q,250)}function s(a){aa&&!Y.is(a.target)&&0===Y.has(a.target).length&&da.close()}function t(a){aa&&27===a.which&&da.close()}function u(){Z&&Z.on(h("click"),da.close),U.closeOnESC&&a(c).on(h("keydown"),t),U.closeOnClickOutside&&a(c).on(h("mouseup"),s).on(h("touchstart"),s),a(b).on(h("resize"),r)}function v(){U.closeButton&&(Z=a("<div/>").addClass(U.closeButtonClass).appendTo(U.addCloseButtonToOverlay?X:Y))}function w(){$&&Y.addClass(U.modalClass+R.effectModifierPrefix+$),Y.addClass(U.modalClass+R.activeModifier),q()}function x(){m(),_=!0,v(),u(),w(),da.element.trigger(h("success"))}function y(){x()}function z(){X&&X.stop().fadeOut(U.animationDuration),a("html").css("overflow","auto"),aa=!1}function A(){m(),z(),da.element.trigger(h("error"))}function B(){A()}function C(){da.element.on("ajax:complete",p).on("ajax:success",y).on("ajax:error",B)}function D(){return X||(X=a("<div/>").addClass(U.overlayClass).css("z-index",U.zIndex-2).hide().appendTo("body")),X}function E(){aa=!0,a("html").css("overflow","hidden"),D().stop().fadeIn(U.animationDuration)}function F(){W||(W=a("<div/>").addClass(U.modalClass+R.elements.spinner).addClass(U.spinnerClass).append(U.spinnerHTML)),W.appendTo(X).show()}function G(){_=!1,E(),U.showSpinner&&F(),da.element.trigger(h("ready"))}function H(b){if(b.unobtrusive)return Q.UNOBTRUSIVE;if(b.link&&"#"===b.link.charAt(0)&&!b.unobtrusive){if(0===a(b.link).length)throw new Error("Modal content not found!");return Q.STATIC}return Q.DYNAMIC}function I(){return U.modifiers.length>0?" "+U.modifiers:""}function J(b){k(),ca=H(b);var c=a("<div/>").addClass(U.modalClass+R.elements.content);return a("<div/>",{"class":U.modalClass+I(),id:U.modalId,width:U.width,height:U.height}).css("z-index",U.zIndex).data("type",ca).data("instance",da).append(c)}function K(){return!U.recreate&&null!==Y}function L(){Y.removeClass(U.modalClass+R.activeModifier)}function M(b){b.preventDefault();var c=a(b.currentTarget);da.open({link:V,unobtrusive:c.data("remote")})}function N(){da.element.on(h("click"),M)}function O(a){if(a.data("remote")&&a.data("url"))return a.data("url");if(a.attr("href"))return a.attr("href");throw new Error("Link undefined!")}function P(){$=da.element.data(S.effect),V=O(da.element),N()}var Q={STATIC:"static",DYNAMIC:"dynamic",UNOBTRUSIVE:"unobtrusive"},R={activeModifier:"--active",effectModifierPrefix:"--effect-",overlay:"overlay",spinnerModifier:"--default",modal:{name:"modal",verticalAlignTop:"modal--vertical-align-top",verticalAlignCenter:"modal--vertical-align-center"},elements:{closeButton:"__button-close",spinner:"__spinner",content:"__content"}},S={effect:"modal-effect"},T={animationDuration:500,closeOnESC:!0,closeOnClickOutside:!0,closeButton:!0,closeButtonClass:R.modal.name+R.elements.closeButton,addCloseButtonToOverlay:!1,overlayClass:R.overlay,modalClass:R.modal.name,modalId:R.modal.name,modalVAlignTopClass:R.modal.verticalAlignTop,modalVAlignCenterClass:R.modal.verticalAlignCenter,modifiers:"",showSpinner:!0,spinnerClass:R.modal.name+R.elements.spinner+R.spinnerModifier,spinnerHTML:"",width:"80%",height:"auto",zIndex:102,recreate:!0};this.element=a(d);var U=a.extend({},T,f),V=null,W=null,X=null,Y=null,Z=null,$=null,_=!1,aa=!1,ba=0,ca=Q.STATIC,da=this;this.getSettings=function(){return U},this.getModal=function(){return Y},this.getOverlay=function(){return X},this.getEffect=function(){return $},this.active=function(){return Y.hasClass(U.modalClass+R.activeModifier)},this.destroy=function(){i(),j(),k(),g(),this.element.off(h("click")).removeData("plugin_"+e)},this.open=function(b){if(!b)throw new Error("Data for modal launch missing!");if(!b.link)throw new Error("Link to modal content missing!");if(K())return o();switch(Y=J(b).appendTo(D()),G(),ca){case Q.STATIC:da.setContent(a(V).html()),x();break;case Q.DYNAMIC:a.get(V).done(function(a){da.setContent(a),x()}).fail(function(){A()});break;case Q.UNOBTRUSIVE:C();break;default:throw new Error("Invalid modal type!")}},this.close=function(){n(),L(),z(),i(),j(),k()},this.setContent=function(a){Y.find("."+U.modalClass+R.elements.content).html(a),q()},P()}var e="iptModal";a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);