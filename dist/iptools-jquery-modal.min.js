/*! iptools-jquery-modal - v1.2.0 - 2016-06-07
* https://github.com/interactive-pioneers/iptools-jquery-modal
* Copyright Â© 2016 Interactive Pioneers GmbH; Licensed GPL-3.0 */
!function(a,b,c){"use strict";function d(d,f){function g(){V&&(V.remove(),V=null)}function h(a){return a+"."+e}function i(){a(c).off(h("keydown")).off(h("mouseup")).off(h("touchstart")),a(b).off(h("resize"))}function j(){ba.element.off("ajax:complete").off("ajax:success").off("ajax:error")}function k(){W&&(W.remove(),W=null,Z=!1)}function l(){U&&(U.hide(),U.remove())}function m(){l(),ba.element.trigger(h("complete"))}function n(){ba.element.trigger(h("close"))}function o(){m()}function p(){var a=W.outerHeight(),b=V.height();a>b?W.removeClass(S.modalVAlignCenterClass).addClass(S.modalVAlignTopClass):W.removeClass(S.modalVAlignTopClass).addClass(S.modalVAlignCenterClass)}function q(){clearTimeout(_),_=setTimeout(p,250)}function r(a){$&&!W.is(a.target)&&0===W.has(a.target).length&&ba.close()}function s(a){$&&27===a.which&&ba.close()}function t(){X&&X.on(h("click"),ba.close),S.closeOnESC&&a(c).on(h("keydown"),s),S.closeOnClickOutside&&a(c).on(h("mouseup"),r).on(h("touchstart"),r),a(b).on(h("resize"),q)}function u(){S.closeButton&&(X=a("<div/>").addClass(S.closeButtonClass).appendTo(S.addCloseButtonToOverlay?V:W))}function v(){Y&&W.addClass(S.modalClass+P.effectModifierPrefix+Y),W.addClass(S.modalClass+P.activeModifier),p()}function w(){m(),Z=!0,u(),t(),v(),ba.element.trigger(h("success"))}function x(){w()}function y(){V&&V.stop().fadeOut(S.animationDuration),a("html").css("overflow","auto"),$=!1}function z(){m(),y(),ba.element.trigger(h("error"))}function A(){z()}function B(){ba.element.on("ajax:complete",o).on("ajax:success",x).on("ajax:error",A)}function C(){return V||(V=a("<div/>").addClass(S.overlayClass).css("z-index",S.zIndex-2).hide().appendTo("body")),V}function D(){$=!0,a("html").css("overflow","hidden"),C().stop().fadeIn(S.animationDuration)}function E(){U||(U=a("<div/>").addClass(S.modalClass+P.elements.spinner).addClass(S.spinnerClass).append(S.spinnerHTML)),U.appendTo(V).show()}function F(){Z=!1,D(),S.showSpinner&&E(),ba.element.trigger(h("ready"))}function G(b){if(b.unobtrusive)return O.UNOBTRUSIVE;if(b.link&&"#"===b.link.charAt(0)&&!b.unobtrusive){if(0===a(b.link).length)throw new Error("Modal content not found!");return O.STATIC}return O.DYNAMIC}function H(){return S.modifiers.length>0?" "+S.modifiers:""}function I(b){k(),aa=G(b);var c=a("<div/>").addClass(S.modalClass+P.elements.content);return a("<div/>",{"class":S.modalClass+H(),id:S.modalId,width:S.width,height:S.height}).css("z-index",S.zIndex).data("type",aa).data("instance",ba).append(c)}function J(){W.removeClass(S.modalClass+P.activeModifier)}function K(b){b.preventDefault();var c=a(b.currentTarget);ba.open({link:T,unobtrusive:c.data("remote")})}function L(){ba.element.on(h("click"),K)}function M(a){if(a.data("remote")&&a.data("url"))return a.data("url");if(a.attr("href"))return a.attr("href");throw new Error("Link undefined!")}function N(){Y=ba.element.data(Q.effect),T=M(ba.element),L()}var O={STATIC:"static",DYNAMIC:"dynamic",UNOBTRUSIVE:"unobtrusive"},P={activeModifier:"--active",effectModifierPrefix:"--effect-",overlay:"overlay",spinnerModifier:"--default",modal:{name:"modal",verticalAlignTop:"modal--vertical-align-top",verticalAlignCenter:"modal--vertical-align-center"},elements:{closeButton:"__button-close",spinner:"__spinner",content:"__content"}},Q={effect:"modal-effect"},R={animationDuration:500,closeOnESC:!0,closeOnClickOutside:!0,closeButton:!0,closeButtonClass:P.modal.name+P.elements.closeButton,addCloseButtonToOverlay:!1,overlayClass:P.overlay,modalClass:P.modal.name,modalId:P.modal.name,modalVAlignTopClass:P.modal.verticalAlignTop,modalVAlignCenterClass:P.modal.verticalAlignCenter,modifiers:"",showSpinner:!0,spinnerClass:P.modal.name+P.elements.spinner+P.spinnerModifier,spinnerHTML:"",width:"80%",height:"auto",zIndex:102};this.element=a(d);var S=a.extend({},R,f),T=null,U=null,V=null,W=null,X=null,Y=null,Z=!1,$=!1,_=0,aa=O.STATIC,ba=this;this.getSettings=function(){return S},this.getModal=function(){return W},this.getOverlay=function(){return V},this.getEffect=function(){return Y},this.active=function(){return W.hasClass(S.modalClass+P.activeModifier)},this.destroy=function(){i(),j(),k(),g(),this.element.off(h("click")).removeData("plugin_"+e)},this.open=function(b){if(!b)throw new Error("Data for modal launch missing!");if(!b.link)throw new Error("Link to modal content missing!");switch(W=I(b).appendTo(C()),F(),aa){case O.STATIC:ba.setContent(a(T).html()),w();break;case O.DYNAMIC:a.get(T).done(function(a){ba.setContent(a),w()}).fail(function(){z()});break;case O.UNOBTRUSIVE:B();break;default:throw new Error("Invalid modal type!")}},this.close=function(){n(),J(),y(),i(),j(),k()},this.setContent=function(a){W.find("."+S.modalClass+P.elements.content).html(a),p()},N()}var e="iptModal";a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);