/*! iptools-jquery-modal - v1.1.0 - 2016-05-10
* https://github.com/interactive-pioneers/iptools-jquery-modal
* Copyright Â© 2016 Interactive Pioneers GmbH; Licensed GPL-3.0 */
!function(a,b,c){"use strict";function d(d,f){function g(){U&&(U.remove(),U=null)}function h(a){return a+"."+e}function i(){a(c).off(h("keydown")).off(h("mouseup")).off(h("touchstart")),a(b).off(h("resize"))}function j(){aa.element.off("ajax:complete").off("ajax:success").off("ajax:error")}function k(){V&&(V.remove(),V=null,Y=!1)}function l(){T&&(T.hide(),T.remove())}function m(){l(),aa.element.trigger(h("complete"))}function n(){m()}function o(){var a=V.outerHeight(),b=U.height();a>b?V.removeClass(R.modalVAlignCenterClass).addClass(R.modalVAlignTopClass):V.removeClass(R.modalVAlignTopClass).addClass(R.modalVAlignCenterClass)}function p(){clearTimeout($),$=setTimeout(o,250)}function q(a){Z&&!V.is(a.target)&&0===V.has(a.target).length&&aa.close()}function r(a){Z&&27===a.which&&aa.close()}function s(){W&&W.on(h("click"),aa.close),R.closeOnESC&&a(c).on(h("keydown"),r),R.closeOnClickOutside&&a(c).on(h("mouseup"),q).on(h("touchstart"),q),a(b).on(h("resize"),p)}function t(){R.closeButton&&(W=a("<div/>").addClass(R.closeButtonClass).appendTo(R.addCloseButtonToOverlay?U:V))}function u(){X&&V.addClass(R.modalClass+O.effectModifierPrefix+X),V.addClass(R.modalClass+O.activeModifier),o()}function v(){m(),Y=!0,t(),s(),u(),aa.element.trigger(h("success"))}function w(){v()}function x(){U&&U.stop().fadeOut(R.animationDuration),a("body").css("overflow","auto"),Z=!1}function y(){m(),x(),aa.element.trigger(h("error"))}function z(){y()}function A(){aa.element.on("ajax:complete",n).on("ajax:success",w).on("ajax:error",z)}function B(){return U||(U=a("<div/>").addClass(R.overlayClass).css("z-index",R.zIndex-2).hide().appendTo("body")),U}function C(){Z=!0,a("body").css("overflow","hidden"),B().stop().fadeIn(R.animationDuration)}function D(){T||(T=a("<div/>").addClass(R.modalClass+O.elements.spinner).addClass(R.spinnerClass).append(R.spinnerHTML)),T.appendTo(U).show()}function E(){Y=!1,C(),R.showSpinner&&D(),aa.element.trigger(h("ready"))}function F(b){if(b.unobtrusive)return N.UNOBTRUSIVE;if(b.link&&"#"===b.link.charAt(0)&&!b.unobtrusive){if(0===a(b.link).length)throw new Error("Modal content not found!");return N.STATIC}return N.DYNAMIC}function G(){return R.modifiers.length>0?" "+R.modifiers:""}function H(b){k(),_=F(b);var c=a("<div/>").addClass(R.modalClass+O.elements.content);return a("<div/>",{"class":R.modalClass+G(),id:R.modalId,width:R.width,height:R.height}).css("z-index",R.zIndex).data("type",_).data("instance",aa).append(c)}function I(){V.removeClass(R.modalClass+O.activeModifier)}function J(b){b.preventDefault();var c=a(b.currentTarget);aa.open({link:S,unobtrusive:c.data("remote")})}function K(){aa.element.on(h("click"),J)}function L(a){if(a.data("remote")&&a.data("url"))return a.data("url");if(a.attr("href"))return a.attr("href");throw new Error("Link undefined!")}function M(){X=aa.element.data(P.effect),S=L(aa.element),K()}var N={STATIC:"static",DYNAMIC:"dynamic",UNOBTRUSIVE:"unobtrusive"},O={activeModifier:"--active",effectModifierPrefix:"--effect-",overlay:"overlay",spinnerModifier:"--default",modal:{name:"modal",verticalAlignTop:"modal--vertical-align-top",verticalAlignCenter:"modal--vertical-align-center"},elements:{closeButton:"__button-close",spinner:"__spinner",content:"__content"}},P={effect:"modal-effect"},Q={animationDuration:500,closeOnESC:!0,closeOnClickOutside:!0,closeButton:!0,closeButtonClass:O.modal.name+O.elements.closeButton,addCloseButtonToOverlay:!1,overlayClass:O.overlay,modalClass:O.modal.name,modalId:O.modal.name,modalVAlignTopClass:O.modal.verticalAlignTop,modalVAlignCenterClass:O.modal.verticalAlignCenter,modifiers:"",showSpinner:!0,spinnerClass:O.modal.name+O.elements.spinner+O.spinnerModifier,spinnerHTML:"",width:"80%",height:"auto",zIndex:102};this.element=a(d);var R=a.extend({},Q,f),S=null,T=null,U=null,V=null,W=null,X=null,Y=!1,Z=!1,$=0,_=N.STATIC,aa=this;this.getSettings=function(){return R},this.getModal=function(){return V},this.getOverlay=function(){return U},this.getEffect=function(){return X},this.active=function(){return V.hasClass(R.modalClass+O.activeModifier)},this.destroy=function(){i(),j(),k(),g(),this.element.off(h("click")).removeData("plugin_"+e)},this.open=function(b){if(!b)throw new Error("Data for modal launch missing!");if(!b.link)throw new Error("Link to modal content missing!");switch(V=H(b).appendTo(B()),E(),_){case N.STATIC:aa.setContent(a(S).html()),v();break;case N.DYNAMIC:a.get(S).done(function(a){aa.setContent(a),v()}).fail(function(){y()});break;case N.UNOBTRUSIVE:A();break;default:throw new Error("Invalid modal type!")}},this.close=function(){I(),x(),i(),j(),k()},this.setContent=function(a){V.find("."+R.modalClass+O.elements.content).html(a),o()},M()}var e="iptModal";a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new d(this,b))})}}(jQuery,window,document);